
import messaging, grabbers, time, random, os, translate, filters, platform, transmit, calendar, sqlite3
from redis import Redis
from rq import Connection, Queue

def tick():
    cursor.execute('''SELECT name, phone, email, sign, language, interval FROM contacts''')
    for row in cursor:
        current_contact = messaging.Contact(row[0],row[1],row[2],row[3],row[4],row[5])
	num = random.randint(1,4)
        if num == 1:
            transmit.send_joke(current_contact)
            print 'Joke sent at %(time)s' % \
                {'time':str(time.ctime())}
            print
        elif num == 2:
            transmit.send_dog_pic(current_contact)
            print 'Dog pic at %(time)s' % \
                {'time':str(time.ctime())}
            print
        elif num == 3:
            transmit.send_meme(current_contact)
            print 'Meme sent at %(time)s' % \
                {'time':str(time.ctime())}
            print
        elif num == 4:
            if scope_sent and (scope_timestamp - calendar.timegm(time.gmtime()) >= 86400):
                scope_sent = False
            if not scope_sent:
                transmit.send_scope(current_contact)
                print 'Horoscope sent at %(time)s' % \
                    {'time':str(time.ctime())}
                scope_sent = True
                scope_timestamp = calendar.timegm(time.gmtime())
                print
            else:
                print 'Horoscope already sent today, moving on...'
                print ''
