import messaging, grabbers, time, random, os, translate, filters, platform

def send_joke(name):
    print "fetching joke..." 
    data = chuck_norris.get_source()
    joke = data['value']['joke']
    joke.encode('ascii','ignore')
    print "checking for profanity..."  
    is_safe = filters.profanity(joke)
    if is_safe and name.language == 2:
        print "no profanity detected." 
        print joke
        print "translating to Spanish...", 
        es_joke = translate.spanish(joke)
        time.sleep(1)
        print "Done."
        print es_joke
        name.send_sms(es_joke)
        name.send_email('Another Check Norris Joke :) ',joke)
    elif not is_safe: 
        print "profanity detected, joke not sent"
        print ''
    else:
        print "no profanity detected." 
        print joke
        name.send_sms(joke)
        name.send_email('Another Check Norris Joke :) ',joke)
        
def send_dog_pic(name):
    print "fetching hilarious dog pic..." 
    with open(dog_pics.header_file,'r') as inf:
        api_key = eval(inf.read())
    data = dog_pics.get_source(payload=api_key)
    link = data['source']
    print link
    name.send_sms(link)
    name.send_email('Hilarious Dog Enclosed',link)

def send_meme(name):
    print "fetching meme..." 
    data = memes.get_source()
    meme = data['post']['image']
    name.send_sms(meme)
    name.send_email('Check this out..',meme)
    print meme

def send_scope(name):
    print 'fetching horoscope...'
    sign = {'sign':name.sign}
    data = scope.get_source(payload=sign)
    horoscope = data['horoscope']['horoscope']
    horoscope = horoscope.encode('ascii','ignore')
    if name.language == 2:
        print horoscope
        print 'Translating to Spanish...'
        es_horoscope = translate.spanish(horoscope)
        es_horoscope = es_horoscope.encode('ascii','ignore')
        print es_horoscope
        name.send_sms(es_horoscope)
        name.send_email('Your horoscope...',es_horoscope)
    else:
        print horoscope
        name.send_sms(horoscope)
        name.send_email('Your horoscope...',horoscope)
    
